{% extends "::base.html.twig" %}
{% block title %}Symplifica - Activar Suscripción{% endblock %}

{% block fos_user_content %}
    <style>
        .noUi-horizontal {
            height: 6px;
            background-color: #00CBC9;
        }

        .noUi-horizontal .noUi-handle {
            border-radius: 10px;
            box-shadow: none;
            width: 20px;
            left: -10px;
            height: 20px;
            top: -8px;
        }
        .noUi-horizontal .noUi-handle:before,.noUi-horizontal .noUi-handle:after {
            display: none;
        }

        .noUi-target {
            box-shadow: none;
        }
    </style>
    {% for flash_message in app.session.flashbag.get('error') %}
        <div class="alert alert-danger flashSubscription" role="alert"> 
            {{ flash_message }}
        </div>
    {% endfor %}
    <div class="col-sm-12 col-xs-12 align-Resp">
        <div id="" class="col-sm-12 col-xs-12 blockStep inline">
            <div id="" class="col-md-2 col-xs-12 txt-AD0" style="text-align: left;">
                <img src="/img/block-inline.png" class="center-block">                    
            </div>
            <div id="" class="col-md-10 col-xs-12 txt-AD1">
                <div id="" class="text-left">
                    <span class="step">Paso 3 de 4</span>                            
                    Subscripción a Symplifica
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 text-center">
        {% set day = startDate|date("d") %}
        {% set month = startDate|date("F")|trans %}
        {% set year = startDate|date("Y") %}
        {% set day_pay = startDate|date("d") %}
        {% set month_pay = startDate|date("F")|trans %}
        {% set year_pay = startDate|date("Y") %}   
        <p>
            En este momento cuenta con SERVICIO GRATUITO hasta el {{ day }} de {{ month }} de {{ year }}. Sin embargo ya puede llevar a cabo la activación de la suscripción al servicio de Symplifica.
        </p>
        <p>
            De acuerdo a la información registrada, usted cuenta con los siguientes empleados:
        </p> 
    </div>
    <div class="col-lg-1 result_ajax"></div>
    <form action="{{ path('subscription_confirm') }}" method="POST">  
        <div id="employees" class="col-xs-12">
            <div class="row-fluid clearfix">
                <input type="hidden" id="descuento_percent" value="{{ descuento_3er['percent'] }}"/>  
                <input type="hidden" id="descuento_value" value="{{ descuento_3er['value'] }}"/>      
                {% for key, producto in productos %}
                    <input type="hidden" id="{{ producto.simpleName }}" value="{{ producto.price }}"/>
                    <input type="hidden" id="{{ producto.simpleName }}_IVA" value="{{ producto.taxTax.value }}"/>
                {% endfor %}
                <div class="col-md-12 text-center">
                    {% for employeeData in employees %}

                        {% set employee = employeeData['employee'] %}
                        {% set contrato = employeeData['contrato'] %}
                        {% set producto = employeeData['product'] %}

                        <div class="col-md-4 col-sm-6 employee text-center">
                            <div class="row-fluid">
                                <div class="col-xs-12 {{ employee.state>0 ?'activo':'inactivo' }} {{ employee.employeeEmployee.personPerson.gender!='MAS'?'female':'male' }}">
                                    <div class="employee_name">
                                        <b>{{ employee.employeeEmployee.personPerson.names ~ ' ' ~ employee.employeeEmployee.personPerson.lastname1}}</b>
                                    </div>
                                    {% set tipo_tiempo_contrato = contrato.workableDaysMonth %}
                                    <div class="{{ ((contrato.workableDaysMonth) >= 20)? 'tiempo_completo':(((contrato.workableDaysMonth) >= 11)? "medio_tiempo":"trabajo_por_dias" ) }}">
                                        Labora {{ (contrato.workableDaysMonth)|number_format }} días al mes
                                    </div>
                                    <div>
                                        <div class="btn btn-default btn-change-state-contract" data-href="{{ path('change_state_employer_employee', {'id': employee.idEmployerHasEmployee }) }}"  data-value="{{ (producto?producto.price:0)|number_format }}">{{ employee.state?'Inhabilitar':'Activar' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}

                    <div class="col-md-4 col-sm-6 employee add" style="text-align: center">
                        <div class="row-fluid">
                            <div class="col-xs-12">
                                <a href="/register/employee" class="notAjax"><i class="fa fa-plus-circle fa-4x"></i><br />
                                    Agregar empleado</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 text-center">
                        <div style="text-align: center; margin-top: 20px; font-weight: bold">
                            <span id="open_pricing_calc" data-toggle="modal" data-target="#modal_price_calculator">Calcule el valor de suscripción</span>
                        </div>
                        <span style="color: #B0B2B5">Calcula cuánto sería el valor de la suscripción mensual si ingresas más empleados</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12 center" style="margin-top: 30px">
            <div class="col-md-12" style="margin-bottom: 20px;">
                <h4>Monto de la mensualidad</h4>
                <h4 style="color: #FD9224">El primer mes es gratis*</h4>
            </div>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-2">

                    </div>
                    <div class="col-md-8 text-left" style="border-bottom: 1px #E6E7E8 solid; padding-bottom: 10px;">

                        {% for employeeData in employees %}
                            {% set employee = employeeData['employee'] %}
                            {% set contrato = employeeData['contrato'] %}
                            {% set product = employeeData['product'] %}
                            <div class="col-md-12">
                                <div class="col-md-9">       
                                    <span class="name">{{ employee.employeeEmployee.personPerson.names ~' '~ employee.employeeEmployee.personPerson.lastName1 }}</span>
                                    <span class="labora">Labora {{ contrato.workableDaysMonth }} días al mes.</span>
                                </div>  
                                <div class="col-md-3  text-right">
                                    <b>$ {{ (product!=null?product.price:0)|number_format }}</b>
                                    {% if employee.isFree > 0 %}
                                        <span style="font-size: 10px;">{{ employee.isFree?"(* promo sin costo "~employee.isFree~" mes)":"" }}</span>                                    
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                        <div class="col-md-2">

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2">

                    </div>
                    <div class="col-md-8"  style="border-bottom: 1px #E6E7E8 solid; padding-bottom: 10px;">
                        {% if total_sin_descuentos > 0 %}
                            <div class="col-md-12">
                                <div class="col-md-9 text-right" style="font-size: 15px; padding-top: 5px;">
                                    <b>SUBTOTAL</b>
                                </div>  
                                <div class="col-md-3 text-right" style="padding-top: 5px;">
                                    <div  style="font-size: 15px;"><b>$ {{ total_sin_descuentos|number_format  }}</b></div>
                                    <input type="hidden" id="subtotal" value="{{ total_sin_descuentos }}">  
                                </div>
                            </div> 
                        {% endif %}
                        {% if descuento_3er['value'] and descuento_3er['value']  > 0%}
                            <div class="col-md-12">
                                <div class="col-md-9 text-right" style="font-size: 10px; padding-top: 5px;">
                                    <b>Descuento por tener 3 o mas empleados</b>
                                </div>  
                                <div class="col-md-3 text-right" style="padding-top: 5px;">                                       
                                    <div  style="font-size: 10px;"><b>$ {{ descuento_3er['value']|number_format }}</b></div>
                                </div>
                            </div> 
                        {% endif%}
                        <div class="col-md-12" id="descuento_isRefered">
                            {% if descuento_isRefered['object'] and descuento_isRefered['value'] > 0 %}
                                <div class="col-md-9 text-right" style="font-size: 10px; padding-top: 5px;">
                                    <b>Descuento por ser referido</b>
                                </div>  
                                <div class="col-md-3 text-right" style="padding-top: 5px;">
                                    <div  style="font-size: 10px;"><b>$ {{ descuento_isRefered['value']|number_format }}</b></div>
                                </div>
                            {% endif%}
                        </div> 
                        {% if descuento_haveRefered['object'] and descuento_haveRefered['value'] > 0 %}
                            <div class="col-md-12">
                                <div class="col-md-9 text-right" style="font-size: 10px; padding-top: 5px;">
                                    <b>Descuento por tener {{ descuento_haveRefered['object']|length }} referido(s)</b>
                                </div>  
                                <div class="col-md-3 text-right" style="padding-top: 5px;">                                       
                                    <div  style="font-size: 10px;"><b>$ {{ descuento_haveRefered['value']|number_format }}</b></div>
                                </div>
                            </div> 
                        {% endif%}
                        <div class="col-md-12">
                            <div class="col-md-9 text-right" style="font-size: 20px; padding-top: 5px;">
                                <b>TOTAL</b>
                            </div>  
                            <div class="col-md-3 text-right" style="padding-top: 5px;">
                                <div id="divTotal" style="font-size: 20px;"><b>$ {{ (total_con_descuentos)|number_format  }}</b></div>
                                <input type="hidden" id="total" value="{{ total_con_descuentos }}">  
                                <div style="font-size: 10px;">IVA incluido</div>
                            </div>
                        </div>
                    </div>      
                </div>
            </div>
        </div>
        <div class="col-xs-12">
            <div class="row">
                <div style="text-align: center; margin-top: 20px;">
                    <input type="submit" class="btn btn-orange" value="Continuar con el pago"/>
                </div>
            </div>
        </div>
    </form>
    <!-- Modal Confirm-->
    <div class="modal fade"  role="dialog" id="modal_confirm">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content"><div class="modal-body" style="padding: 0">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 15px; top: 15px;z-index: 100; color: #fff;"><span aria-hidden="true">&times;</span></button>
                    <div class="row-fluid block-Intro-green clearfix" id="msgSinVerificar1" style="margin-top: 0;">
                        <div class="col-sm-12 col-xs-12 up-Intro" style="font-size: 26px;">Confirmación de inactivación de empleado</div>
                    </div>
                    <div class="row-fluid clearfix" style="padding-top: 30px; padding-bottom: 30px;">
                        <div class="col-md-8 col-md-push-2">
                            <p>
                                Si inactiva al empleado no se llevará a cabo a través de nuestra herramienta el pago de sueldo ni aportes a seguridad social así como tampoco se gestionará la información relacionada con él.
                            </p>
                            <p>
                                Tenga en cuenta que debe tener como mínimo un (1) empleado activo.
                            </p>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 text-right">
                                <button type="button" class="btn btnPrevious" data-dismiss="modal">Volver atrás</button>
                            </div>
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-orange btn-change-state-contract-confirm">Confirmar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.modal -->

    <!-- Modal Pricing Calculator-->
    <div class="modal fade" tabindex="-1" role="dialog" id="modal_price_calculator">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content"><div class="modal-body" style="padding: 0">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 15px; top: 15px;z-index: 100; color: #fff;"><span>&times;</span></button>
                    <div class="row-fluid block-Intro-green clearfix" id="msgSinVerificar1" style="margin-top: 0;">
                        <div class="col-sm-12 col-xs-12 up-Intro" style="font-size: 26px;">Cálculo del valor de la suscripción a Symplifica</div>
                    </div>
                    <div class="row-fluid clearfix" style="padding-top: 30px; padding-bottom: 30px;">
                        <div class="col-xs-12">
                            <div class="divSlider">                        
                                <div class="type_employee">
                                    <span class="type_time">Tiempo Parcial</span>
                                    <span class="type_time_desc">Trabaja(n) 1 a 10 días al mes</span>
                                </div>           
                                <div class="slider_employee" id="tiempo_parcial"></div>
                            </div>
                            <div class="divSlider">                        
                                <div class="type_employee">
                                    <span class="type_time">Medio Tiempo</span>
                                    <span class="type_time_desc">Trabaja(n) 11 a 19 días al mes</span>
                                </div>              
                                <div class="slider_employee" id="medio_tiempo"></div>
                            </div>
                            <div class="divSlider">                          
                                <div class="type_employee">
                                    <span class="type_time">Tiempo Completo</span>
                                    <span class="type_time_desc">Trabaja(n) más de 20 días al mes</span>
                                </div>        
                                <div class="slider_employee" id="tiempo_completo"></div>
                            </div>
                            <div class="" style="display: inline-block; text-align: center; width: 100%;">
                                Valor suscripción mensual
                                <div class="div_price">     
                                    <div id="result_price_calc"></div>      
                                    <div id="result_discount_calc"></div>    
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6 text-right">
                                    <button type="button" class="btn" data-dismiss="modal">Volver atrás</button>
                                </div>
                                <div class="col-xs-6">
                                    <a type="button" class="btn btn-orange btn-add-employee notAjax" href="{{ path('register_employee') }}">Agregar un empleado</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.modal -->

{% endblock %}
