
{% extends "::base.html.twig" %}
{% block fos_user_content%}


{% endblock fos_user_content%}
{% block javascripts %}
{{ parent() }}
<script>
var state="/old";

jQuery(document).ready(function() {
	$("a").on("click",function(e){
		e.preventDefault();
		sendAjax($(this).attr('href'));
	});
	{# ajax que maneja los requests #}
	sendAjax(state);
});

function sendAjax (url, form) {

	$.ajax({
		url : url,
		type: $(form).attr('method'),
		data: $(form).serializeArray(),
		statusCode: {
			500: function() {
				alert(" 500 Server might not handle That yet");
			}
		}
		}).done(function(data) {
			if(data["url"]!=null){
				console.log(data["url"]);
				sendAjax(data["url"]);
			}else{
				$('#main').replaceWith(
						// ... with the returned one from the AJAX response.
						$(data).find('#main'));
				addClick();
				if (!jsLoader(url)) {
					addSumbit();
				}
			}
		}).fail(function( jqXHR, textStatus, errorThrown ) {
			alert(jqXHR+"Server might not handle That yet" + textStatus+" " + errorThrown);
	});
}
function addClick () {
	$("#main .nav-link").on("click",function(e){
		e.preventDefault();
		sendAjax($(this).attr('href'));
	});
}
function addSumbit () {
	$("form").on("submit",function(e){
		e.preventDefault();
		sendAjax($(this).attr('action'), $(this));
	});
}
function jsLoader(url){
	if(url.indexOf("{{ path('edit_profile') }}")!==-1){
		$.getScript( "{{ asset('public/js/newEmployer.js') }}").done(function(){
			startEmployer();
		})

		return true;
	}else if(url.indexOf("{{ path('register_employee') }}")!==-1){
		$.getScript( "{{ asset('public/js/newEmployee.js') }}").done(function(){
			startEmployee();
		})

		return true;
	}else if(url.indexOf("{{ path('show_calculator_form') }}")!==-1){
		$.getScript( "{{ asset('public/js/calculator.js') }}").done(function(){
			calculatorCalculate();
		})

		return true;
	}
	return false;
}
</script>
{% endblock javascripts %}